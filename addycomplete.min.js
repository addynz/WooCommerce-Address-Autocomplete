jQuery(document).ready(function () { function e(e, s) { var a = this; a.onDisable = null, a.onPopulate = null; var n = null, t = null, i = null, o = function () { n && n.country && i.nzCountryValue && (n.country.val() === i.nzCountryValue ? p() : c()) }, d = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (e) { var s = 16 * Math.random() | 0; return ("x" == e ? s : 3 & s | 8).toString(16) }); a.setOptions = function (e) { i = jQuery.extend({ maxResults: 10, excludePostBox: !1, missingAddressLabel: "Can't find your address? Click to type it in manually", notFoundLabel: "No address found", nzCountryValue: "NZ" }, e), o() }, a.setAddressFields = function (e) { n = e, o(), n && n.country && n.country.change(function () { o() }) }, a.setHiddenFields = function (e) { (t = e) && "" === s.val() && u(!1) }; var r = -1, l = 0; a.setOptions({}); var u = function (e) { t && jQuery.each(t, function (s, a) { e ? a.show() : a.hide() }) }, c = function () { s.attr("autocomplete", "off"), s.autocomplete("disable"), s.attr("placeholder", ""), u(!0), l = -1, a.onDisable && a.onDisable() }, p = function () { s.attr("autocomplete", "on"), s.autocomplete("enable") }, y = function () { s.val() && jQuery.ajax({ url: "https://www.addy.co.nz/api/addressnotfound?=" + s.val() + "&session=" + d + "&key=" + e, dataType: "jsonp", cache: !1, success: function () { }, error: function () { } }) }, f = function (s) { l = s, jQuery.ajax({ url: "https://www.addy.co.nz/api/address/" + s + "?session=" + d + "&key=" + e, dataType: "jsonp", cache: !1, success: function (e) { if (a.onPopulate) a.onPopulate(e); else if (n) { var s = n; if (s.address && s.address.val(e.displayline), s.suburb && s.suburb.val(e.suburb), s.city && s.city.val(e.city), s.postcode && s.postcode.val(e.postcode), s.line1 && s.line1.val(e.address1), s.line2 && s.line2.val(e.address2), s.line3 && s.line3.val(e.address3), s.line4 && s.line4.val(e.address4), s.region) { var t = { Auckland: "AK", "Bay Of Plenty": "BP", Canterbury: "CT", Gisborne: "GI", "Hawke's Bay": "HB", "Manawatu-Wanganui": "MW", Marlborough: "MB", Nelson: "NS", Northland: "NL", Otago: "OT", Southland: "SL", Taranaki: "TK", Tasman: "TM", Waikato: "WA", Wellington: "WE", "West Coast": "WC", "Chatham Islands": null }; s.region.select2().val(t[e.region]).trigger("change") } s.address1 && s.address2 && (e.address4 || 0 === e.address2.indexOf("RD ") ? (s.address1.val(e.address1), s.address2.val(e.address2)) : (s.address1.val(e.displayline), s.address2.val(""))) } u(!0) }, error: function (e, s, a) { c() } }) }; s.autocomplete({ source: function (s, a) { jQuery.ajax({ url: "https://www.addy.co.nz/api/search?session=" + d + "&key=" + e + "&expostbox=" + i.excludePostBox + "&max=" + i.maxResults + "&s=" + s.term, dataType: "jsonp", cache: !1, success: function (e) { r = 0, 0 === e.addresses.length ? e.addresses.push({ id: 0, a: i.notFoundLabel }) : r = e.addresses[0].id, 0 === e.matched && e.addresses.push({ id: -1, a: i.missingAddressLabel }), a(jQuery.map(e.addresses, function (e) { return { label: e.a, id: e.id } })) }, error: function (e, s, a) { r = 0, c() } }) }, minLength: 3, select: function (e, s) { if (e.preventDefault(), s.item) { if (s.item.id < 1) return void (-1 === s.item.id && (y(), c())); f(s.item.id) } }, autoFocus: !0, open: function () { jQuery(this).removeClass("ui-corner-all").addClass("ui-corner-top"), l = 0 }, close: function () { jQuery(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }).blur(function () { 0 === l && (r > 0 ? f(r) : -1 === r && s.autocomplete("search")), u(!0) }) } if (jQuery.ui.autocomplete.prototype._renderItem = function (e, s) { switch (s.id) { case -1: return jQuery("<li></li>").data("item.autocomplete", s).append('<a style="text-decoration: underline; color: #005EA9 !important;">' + s.label + "</a>").appendTo(e); case 0: return jQuery("<li></li>").data("item.autocomplete", s).append("<b>" + s.label + "</b>").appendTo(e); default: var a = this.term.split(" ").join("|"), n = new RegExp("(" + a + ")", "gi"), t = s.label.replace(n, "<b>$1</b>"); return jQuery("<li></li>").data("item.autocomplete", s).append("<a>" + t + "</a>").appendTo(e) } }, jQuery.ui.autocomplete.prototype._resizeMenu = function () { this.menu.element.outerWidth(this.element.outerWidth()) }, addyConfig && addyConfig.key) { if (jQuery("#shipping_address_1")) { var s = new e(addyConfig.key, jQuery("#shipping_address_1")); s.setAddressFields({ address1: jQuery("#shipping_address_1"), address2: jQuery("#billing_address_2"), city: jQuery("#shipping_city"), region: jQuery("#shipping_state"), postcode: jQuery("#shipping_postcode"), country: jQuery("#shipping_country") }), addyConfig.hidePostCode && "yes" === addyConfig.hidePostCode && s.setOptions({ excludePostBox: !0 }) } jQuery("#billing_address_1") && new e(addyConfig.key, jQuery("#billing_address_1")).setAddressFields({ address1: jQuery("#billing_address_1"), address2: jQuery("#billing_address_2"), city: jQuery("#billing_city"), region: jQuery("#billing_state"), postcode: jQuery("#billing_postcode"), country: jQuery("#billing_country") }) } });