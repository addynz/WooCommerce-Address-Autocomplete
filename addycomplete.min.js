jQuery(document).ready(function(){function e(e,a){var s=this;s.onDisable=null,s.onPopulate=null;var n=null,t=null,d=null,i=function(){n&&n.country&&d.nzCountryValue&&(n.country.val()===d.nzCountryValue?c():u())};s.setOptions=function(e){d=jQuery.extend({maxResults:10,excludePostBox:!1,missingAddressLabel:"Can't find your address? Click to type it in manually",notFoundLabel:"No address found",nzCountryValue:"NZ"},e),i()},s.setAddressFields=function(e){n=e,i(),n&&n.country&&n.country.change(function(){i()})},s.setHiddenFields=function(e){(t=e)&&""===a.val()&&l(!1)};var o=-1,r=0;s.setOptions({});var l=function(e){t&&jQuery.each(t,function(a,s){e?s.show():s.hide()})},u=function(){a.attr("autocomplete","off"),a.autocomplete("disable"),a.attr("placeholder",""),l(!0),r=-1,s.onDisable&&s.onDisable()},c=function(){a.attr("autocomplete","on"),a.autocomplete("enable")},y=function(){a.val()&&jQuery.ajax({url:"https://www.addy.co.nz/api/addressnotfound?="+a.val(),dataType:"json",headers:{"addy-api-key":e},cache:!1,success:function(){},error:function(){}})},p=function(a){r=a,jQuery.ajax({url:"https://www.addy.co.nz/api/address/"+a,dataType:"json",headers:{"addy-api-key":e},cache:!1,success:function(e){if(s.onPopulate)s.onPopulate(e);else if(n){var a=n;if(a.address&&a.address.val(e.displayline),a.suburb&&a.suburb.val(e.suburb),a.city&&a.city.val(e.city),a.postcode&&a.postcode.val(e.postcode),a.line1&&a.line1.val(e.address1),a.line2&&a.line2.val(e.address2),a.line3&&a.line3.val(e.address3),a.line4&&a.line4.val(e.address4),a.region){var t={Auckland:"AK","Bay Of Plenty":"BP",Canterbury:"CT",Gisborne:"GI","Hawke's Bay":"HB","Manawatu-Wanganui":"MW",Marlborough:"MB",Nelson:"NS",Northland:"NL",Otago:"OT",Southland:"SL",Taranaki:"TK",Tasman:"TM",Waikato:"WA",Wellington:"WE","West Coast":"WC","Chatham Islands":null};a.region.select2().val(t[e.region]).trigger("change")}a.address1&&a.address2&&(e.address4||0===e.address2.indexOf("RD ")?(a.address1.val(e.address1),a.address2.val(e.address2)):(a.address1.val(e.displayline),a.address2.val("")))}l(!0)},error:function(e,a,s){u()}})};a.autocomplete({source:function(a,s){jQuery.ajax({url:"https://www.addy.co.nz/api/search?expostbox="+d.excludePostBox+"&max="+d.maxResults+"&s="+a.term,dataType:"json",headers:{"addy-api-key":e},cache:!1,success:function(e){o=0,0===e.addresses.length?e.addresses.push({id:0,a:d.notFoundLabel}):o=e.addresses[0].id,0===e.matched&&e.addresses.push({id:-1,a:d.missingAddressLabel}),s(jQuery.map(e.addresses,function(e){return{label:e.a,id:e.id}}))},error:function(e,a,s){o=0,u()}})},minLength:3,select:function(e,a){if(e.preventDefault(),a.item){if(a.item.id<1)return void(-1===a.item.id&&(y(),u()));p(a.item.id)}},autoFocus:!0,open:function(){jQuery(this).removeClass("ui-corner-all").addClass("ui-corner-top"),r=0},close:function(){jQuery(this).removeClass("ui-corner-top").addClass("ui-corner-all")}}).blur(function(){0===r&&(o>0?p(o):-1===o&&a.autocomplete("search")),l(!0)})}if(jQuery.ui.autocomplete.prototype._renderItem=function(e,a){switch(a.id){case-1:return jQuery("<li></li>").data("item.autocomplete",a).append('<a style="text-decoration: underline; color: #005EA9 !important;">'+a.label+"</a>").appendTo(e);case 0:return jQuery("<li></li>").data("item.autocomplete",a).append("<b>"+a.label+"</b>").appendTo(e);default:var s=this.term.split(" ").join("|"),n=new RegExp("("+s+")","gi"),t=a.label.replace(n,"<b>$1</b>");return jQuery("<li></li>").data("item.autocomplete",a).append("<a>"+t+"</a>").appendTo(e)}},jQuery.ui.autocomplete.prototype._resizeMenu=function(){this.menu.element.outerWidth(this.element.outerWidth())},addyConfig&&addyConfig.key){if(jQuery("#shipping_address_1")){var a=new e(addyConfig.key,jQuery("#shipping_address_1"));a.setAddressFields({address1:jQuery("#shipping_address_1"),address2:jQuery("#billing_address_2"),city:jQuery("#shipping_city"),region:jQuery("#shipping_state"),postcode:jQuery("#shipping_postcode"),country:jQuery("#shipping_country")}),addyConfig.hidePostCode&&"yes"===addyConfig.hidePostCode&&a.setOptions({excludePostBox:!0})}jQuery("#billing_address_1")&&new e(addyConfig.key,jQuery("#billing_address_1")).setAddressFields({address1:jQuery("#billing_address_1"),address2:jQuery("#billing_address_2"),city:jQuery("#billing_city"),region:jQuery("#billing_state"),postcode:jQuery("#billing_postcode"),country:jQuery("#billing_country")})}});